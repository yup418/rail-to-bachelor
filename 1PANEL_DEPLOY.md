
# 1Panel 面板部署指南

如果你的服务器安装了 1Panel 面板，部署会变得非常可视化和简单。

## 1. 打包项目代码

为了方便上传，我们先把项目打包成一个压缩包（排除不必要的文件夹）。

在你的**本地电脑**终端运行：

```bash
# 进入项目目录
cd /Users/yup/Desktop/yuxin/rail-to-bachelor

# 打包（排除 node_modules 等大文件）
zip -r rail-to-bachelor.zip . -x "node_modules/*" ".next/*" ".git/*" ".env"
```

> **注意**： `.env` 文件通常包含敏感信息，建议手动在面板配置环境变量，或者如果你觉得安全也可以包进去。上面的命令为了安全排除了 `.env`。

## 2. 上传文件到服务器

1. 打开 **1Panel 面板**。
2. 进入 **【主机】** -> **【文件】**。
3. 进入 `/opt` 目录（或者你喜欢的任何目录），创建一个新文件夹叫 `rail-to-bachelor`。
4. 进入这个新文件夹。
5. 点击 **【上传】**，把刚才打包的 `rail-to-bachelor.zip` 上传上去。
6. 上传完成后，鼠标悬停在文件上，点击 **【解压】**，解压到当前目录。

## 3. 创建容器编排 (Docker Compose)

1. 进入 **【容器】** -> **【编排】**。
2. 点击 **【创建编排】**。
3. 填写信息：
   - **名称**：`rail-to-bachelor`
   - **路径**：选择刚才你解压代码的目录（例如 `/opt/rail-to-bachelor`）。
     *注意：选择路径后，面板通常会自动读取该目录下的 `docker-compose.yml` 内容并显示在下方。*
4. **检查环境变量**：
   - 如果你之前在 `docker-compose.yml` 里写了密码，确认一下密码是否正确。
   - 可以在编辑框里直接修改 `db` 服务的 `POSTGRES_PASSWORD` 和 `app` 服务的 `DATABASE_URL` 里的密码。
5. 点击 **【确认】** 或 **【创建】**。

1Panel 会自动拉取镜像并构建。你可以点击 **【日志】** 查看构建过程，这可能需要几分钟。

当看到状态变为 **"已启动"** (Running)，说明部署成功。

## 4. 配置域名访问 (反向代理)

为了通过域名直接访问（而不是 IP:3000），我们需要创建一个反向代理网站。

1. 进入 **【网站】** -> **【网站】**。
2. 点击 **【创建网站】**。
3. 选择 **【反向代理】**。
4. 填写信息：
   - **主域名**：填写你的域名（例如 `yourdomain.com`）。
   - **代理地址**：`127.0.0.1:3000`
     *(因为我们的 Docker 容器把端口映射到了服务器的 3000 端口)*
5. 点击 **【确认】**。

## 5. 完成！

现在访问你的域名 `http://yourdomain.com`，应该就能看到网站了！

---

## 💡 常用维护操作

### 更新代码
1. 本地修改代码后重新打包 `zip`。
2. 在 1Panel 文件管理中，删除旧代码（保留 `db_data` 卷数据不用担心丢失，因为它是 Docker Volume），上传新包并解压覆盖。
   *更推荐的方式是使用 Git，在服务器安装 Git 并用 `git pull` 更新。*
3. 去 **【容器】** -> **【编排】**，找到 `rail-to-bachelor`。
4. 点击 **【重建】** 或 **【升级】**，勾选 **"构建镜像"**，然后确认。

### 查看日志
在 **【容器】** -> **【容器】** 列表中，找到 `rail-to-bachelor-app`，点击 **【日志】** 图标即可查看运行报错或信息。
